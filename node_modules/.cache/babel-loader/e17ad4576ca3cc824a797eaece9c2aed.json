{"ast":null,"code":"var _jsxFileName = \"/Users/dianatyman/Desktop/music-recom-eval/src/App.js\";\nimport './App.css';\nimport React, { Component } from \"react\";\nimport Button from \"./components/CustomButtonComponent\";\nimport history from './history';\nimport Routes from './Routes';\nimport CBased from \"./CBased/CBased\";\nimport CFiltering from \"./CFiltering/CollabFiltering\";\nimport { BrowserRouter, Route, Switch } from 'react-router-dom';\nimport update from 'react-addons-update';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n\n    this.showHandler = () => {\n      this.setState({\n        isActive: true\n      });\n    };\n\n    this.state = {\n      token: '',\n      dataAudio: [],\n      isActive: false,\n      userName: '',\n      songName: [],\n      songID: [],\n      artistID: [],\n      genres: [],\n      audio_feat: [],\n      limit: 10 // cambiar le limit a 50!\n\n    };\n  }\n\n  getUserData(accessToken) {\n    // Fetch User's profile information\n    fetch('https://api.spotify.com/v1/me', {\n      method: 'GET',\n      headers: {\n        'Authorization': 'Bearer ' + accessToken\n      }\n    }).then(response => response.json()).then(data => this.setState({\n      userName: data.display_name\n    }));\n  }\n\n  getSongID(accessToken) {\n    // Fetch User's most listened/top songs + songs id's\n    fetch('https://api.spotify.com/v1/me/top/tracks?limit=' + this.state.limit, {\n      method: 'GET',\n      headers: {\n        'Authorization': 'Bearer ' + accessToken\n      }\n    }).then(response => response.json()).then(res => {\n      const datas = res.items;\n      const id = [];\n      const ids = datas.map(datas => {\n        if (!id.includes(datas.id)) {\n          id.push(datas.id);\n        }\n\n        ;\n        return id;\n      });\n      this.setState({\n        songID: ids\n      });\n    });\n  }\n\n  getCB_Recom(songIDS, accessToken, genres, artistID) {\n    // Get audio analysis features from the user's songs\n    const energy = []; //low level feature\n\n    const key = []; //high level feature\n\n    const loudness = []; //low level feature -- can be negative\n\n    const acoustic = []; //low level feature (?)\n\n    const instrum = []; //low level feature (?)\n\n    const liveness = []; //low level feature (?)\n\n    const valence = []; //low level feature (?)\n\n    const tempo = []; //high level feature\n\n    const duration = []; //song duration in ms!\n\n    fetch('https://api.spotify.com/v1/audio-features?ids=' + songIDS, {\n      method: 'GET',\n      headers: {\n        'Authorization': 'Bearer ' + accessToken\n      }\n    }).then(response => response.json()) //.then(data => console.log(data.audio_features));\n    .then(data => {\n      data.audio_features.map((audio, i) => {\n        energy.push(Number(audio.energy));\n        key.push(audio.key);\n        loudness.push(audio.loudness);\n        acoustic.push(audio.acousticness);\n        instrum.push(audio.instrumentalness);\n        liveness.push(audio.liveness);\n        valence.push(audio.valence);\n        tempo.push(audio.tempo);\n        duration.push(audio.duration_ms);\n      });\n      const avg_energy = energy.reduce((sum, curr) => sum + curr, 0) / energy.length; //done\n\n      const avg_key = key.reduce((sum, curr) => sum + curr, 0) / key.length; //done\n\n      const avg_loud = loudness.reduce((sum, curr) => sum + curr, 0) / loudness.length; //done\n\n      const avg_acous = acoustic.reduce((sum, curr) => sum + curr, 0) / acoustic.length; //done  \n\n      const avg_instr = instrum.reduce((sum, curr) => sum + curr, 0) / instrum.length; //done\n\n      const avg_liveness = liveness.reduce((sum, curr) => sum + curr, 0) / liveness.length; //done\n\n      const avg_val = valence.reduce((sum, curr) => sum + curr, 0) / valence.length;\n      const avg_tempo = tempo.reduce((sum, curr) => sum + curr, 0) / tempo.length;\n      const avg_duration = duration.reduce((sum, curr) => sum + curr, 0) / duration.length; //done\n      // Get the most popular genre of the user\n\n      const words = genres.split(',');\n      const wordCounts = {};\n\n      for (var i = 0; i < words.length; i++) wordCounts[words[i]] = (wordCounts[words[i]] || 0) + 1;\n\n      const getMax = object => {\n        return Object.keys(object).filter(x => {\n          return object[x] == Math.max.apply(null, Object.values(object));\n        });\n      };\n\n      const userGenre = getMax(wordCounts).toString();\n      const song_seed = songIDS.split(','); //get user's top song for recommendation seed\n      // Get 20 recommendations of content based for the user\n\n      const promise_recom = fetch(\"https://api.spotify.com/v1/recommendations?limit=20&market=ES&seed_artists=\" + artistID + \"&seed_genres=\" + userGenre + \"&seed_tracks=\" + song_seed[0] + \"&target_acousticness=\" + avg_acous + \"&target_duration_ms=\" + avg_duration + \"&target_energy=\" + avg_energy + \"&target_instrumentalness=\" + avg_instr + \"&target_key=\" + avg_key + \"&target_liveness=\" + avg_liveness + \"&target_loudness=\" + avg_loud + \"&target_tempo=\" + avg_tempo + \"&target_valence=\" + avg_val, {\n        method: 'GET',\n        headers: {\n          'Authorization': 'Bearer ' + accessToken\n        }\n      }).then(response => response.json()); //.then(data => console.log(data));\n\n      console.log(promise_recom);\n    }); //console.log(\"...................\");\n    //console.log(this.state.songData);\n  }\n\n  componentDidMount() {\n    const url = new URL(window.location.href);\n    const accessToken = url.searchParams.get('access_token');\n    this.setState({\n      token: accessToken\n    });\n\n    if (!accessToken) {\n      return;\n    } // Fetch User's profile information\n\n\n    fetch('https://api.spotify.com/v1/me', {\n      method: 'GET',\n      headers: {\n        'Authorization': 'Bearer ' + accessToken\n      }\n    }).then(response => response.json()).then(data => this.setState({\n      userName: data.display_name\n    })); // Fetch User's most listened/top songs + songs id's\n\n    fetch('https://api.spotify.com/v1/me/top/tracks?limit=' + this.state.limit, {\n      method: 'GET',\n      headers: {\n        'Authorization': 'Bearer ' + accessToken\n      }\n    }).then(response => response.json()).then(data => {\n      let id = [];\n      let ids = data.items.map(datas => {\n        if (!id.includes(datas.id)) {\n          id.push(datas.id);\n        }\n\n        ;\n        return id;\n      });\n      this.setState({\n        songID: ids\n      });\n    }); // Fetch User's top 3 artists -- nedeed for spotify's api content based recommendations\n\n    fetch('https://api.spotify.com/v1/me/top/artists?limit=3', {\n      method: 'GET',\n      headers: {\n        'Authorization': 'Bearer ' + accessToken\n      }\n    }).then(response => response.json()).then(data => {\n      if (!data.items) {\n        return;\n      }\n\n      let id = [];\n      let gen = [];\n      let ids = data.items.map(datas => {\n        if (!id.includes(datas.id)) {\n          id.push(datas.id);\n        }\n\n        ;\n        return id;\n      });\n      let genre = data.items.map(datas => {\n        if (!gen.includes(datas.genres)) {\n          gen.push(datas.genres);\n        }\n\n        ;\n        this.setState({\n          genres: gen.flat()\n        });\n        return gen;\n      });\n      this.setState({\n        artistID: ids\n      });\n    }); // songIDS,accessToken,genres,artistID\n\n    if (accessToken) {\n      this.getCB_Recom(this.state.songID.toString(), this.state.token, this.state.genres.toString(), this.state.artistID.toString());\n    }\n\n    ;\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"App\",\n      children: [/*#__PURE__*/_jsxDEV(Routes, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 9\n      }, this), this.state.isActive ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"header\", {\n          className: \"App-header\",\n          children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n            children: \"Music Recommendation System Evaluation\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 235,\n            columnNumber: 10\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Music recommendation system where users can choose which recommendation algorithm they enjoy better. This app is part of my final project for my degree in data science imparted by University Pompeu Fabra.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 236,\n            columnNumber: 10\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 10\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 241,\n          columnNumber: 10\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 242,\n          columnNumber: 10\n        }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n          style: {\n            'fontSize': '25px',\n            'marginTop': '5px',\n            'textAlign': 'left',\n            'border': '3px solid #9DC183',\n            'padding': '10px'\n          },\n          children: [\"Content Based Recommendations for \", this.state.userName, \" \"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 243,\n          columnNumber: 10\n        }, this), /*#__PURE__*/_jsxDEV(CBased, {\n          songID: this.state.songID.toString(),\n          token: this.state.token,\n          artistID: this.state.artistID.toString(),\n          genres: this.state.genres.toString()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 244,\n          columnNumber: 10\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 10\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 247,\n          columnNumber: 10\n        }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n          style: {\n            'fontSize': '25px',\n            'marginTop': '5px',\n            'textAlign': 'left',\n            'border': '3px solid #9DC183',\n            'padding': '10px'\n          },\n          children: [\"Collaborative Filtering Recommendations for \", this.state.userName, \" \"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 248,\n          columnNumber: 10\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 10\n      }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => window.location = 'http://localhost:8888/login',\n        children: \"Sign in with Spotify\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 251,\n        columnNumber: 19\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: !this.state.isActive && /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: this.showHandler,\n          children: \"Click here to continue\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 254,\n          columnNumber: 39\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 254,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 7\n    }, this);\n  }\n\n} //<button onClick={this.showHandler}>Click here to continue</button>\n\n\nexport default App;","map":{"version":3,"sources":["/Users/dianatyman/Desktop/music-recom-eval/src/App.js"],"names":["React","Component","Button","history","Routes","CBased","CFiltering","BrowserRouter","Route","Switch","update","App","constructor","props","showHandler","setState","isActive","state","token","dataAudio","userName","songName","songID","artistID","genres","audio_feat","limit","getUserData","accessToken","fetch","method","headers","then","response","json","data","display_name","getSongID","res","datas","items","id","ids","map","includes","push","getCB_Recom","songIDS","energy","key","loudness","acoustic","instrum","liveness","valence","tempo","duration","audio_features","audio","i","Number","acousticness","instrumentalness","duration_ms","avg_energy","reduce","sum","curr","length","avg_key","avg_loud","avg_acous","avg_instr","avg_liveness","avg_val","avg_tempo","avg_duration","words","split","wordCounts","getMax","object","Object","keys","filter","x","Math","max","apply","values","userGenre","toString","song_seed","promise_recom","console","log","componentDidMount","url","URL","window","location","href","searchParams","get","gen","genre","flat","render"],"mappings":"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","sourcesContent":["import './App.css';\nimport React, { Component } from \"react\";\nimport Button from \"./components/CustomButtonComponent\";\nimport history from './history';\nimport Routes from './Routes';\nimport CBased from \"./CBased/CBased\";\nimport CFiltering from \"./CFiltering/CollabFiltering\";\nimport { BrowserRouter, Route, Switch } from 'react-router-dom';\nimport update from 'react-addons-update'; \n\nclass App extends Component {\n\n  \tconstructor(props){\n    \tsuper(props);\n    \tthis.state = {\n      \t\ttoken:'',\n      \t\tdataAudio:[],\n      \t\tisActive:false,\n      \t\tuserName:'',\n      \t\tsongName:[],\n      \t\tsongID:[],\n      \t\tartistID:[],\n      \t\tgenres:[],\n      \t\taudio_feat:[],\n      \t\tlimit:10\t\t\t\t// cambiar le limit a 50!\n    \t}\n  \t}\n\n  \tgetUserData(accessToken){\n  \t\t// Fetch User's profile information\n    \tfetch('https://api.spotify.com/v1/me', {\n      \t\tmethod: 'GET',\n      \t\theaders: {'Authorization': 'Bearer ' + accessToken}\n    \t}).then(response => response.json())\n    \t.then(data => this.setState({\n      \t\tuserName: data.display_name\n    \t}));\n  \t}\n\n  \tgetSongID(accessToken){\n  \t\t// Fetch User's most listened/top songs + songs id's\n\t    fetch('https://api.spotify.com/v1/me/top/tracks?limit=' + this.state.limit, {\n\t      \tmethod: 'GET',\n\t      \theaders: {'Authorization': 'Bearer ' + accessToken}\n\t    }).then(response => response.json())\n\t    .then(res => {\n\t    \tconst datas = res.items\n\t    \tconst id = []\n\t    \tconst ids = datas.map(datas => {\n\t    \t\tif (!id.includes(datas.id)){\n      \t\t\t\tid.push(datas.id)\n\t        \t};\n\t        \treturn id;\n\t    \t})\n\t    \tthis.setState({\n\t    \t\tsongID: ids\n\t    \t})\n\n\t    });\n  \t}\n\n  \tgetCB_Recom(songIDS,accessToken,genres,artistID){\n\t    // Get audio analysis features from the user's songs\n\t    const energy = [];      //low level feature\n\t    const key = [];         //high level feature\n\t    const loudness = [];    //low level feature -- can be negative\n\t    const acoustic = [];    //low level feature (?)\n\t    const instrum = [];     //low level feature (?)\n\t    const liveness = [];    //low level feature (?)\n\t    const valence = [];     //low level feature (?)\n\t    const tempo = [];       //high level feature\n\t    const duration = [];    //song duration in ms!\n\n\t    fetch('https://api.spotify.com/v1/audio-features?ids=' + songIDS, {\n\t      method: 'GET',\n\t      headers: {'Authorization': 'Bearer ' + accessToken}\n\t    }).then(response => response.json())\n\t    //.then(data => console.log(data.audio_features));\n\t    .then(data => {\n\t      data.audio_features.map((audio, i) => {\n\t        energy.push(Number(audio.energy))\n\t        key.push(audio.key)\n\t        loudness.push(audio.loudness)\n\t        acoustic.push(audio.acousticness)\n\t        instrum.push(audio.instrumentalness)\n\t        liveness.push(audio.liveness)\n\t        valence.push(audio.valence)\n\t        tempo.push(audio.tempo)\n\t        duration.push(audio.duration_ms)\n\t      });\n\t      const avg_energy = energy.reduce((sum, curr) => sum + curr, 0)/energy.length ;            //done\n\t      const avg_key = key.reduce((sum, curr) => sum + curr, 0)/key.length ;                     //done\n\t      const avg_loud = loudness.reduce((sum, curr) => sum + curr, 0)/loudness.length ;          //done\n\t      const avg_acous = acoustic.reduce((sum, curr) => sum + curr, 0)/acoustic.length ;         //done  \n\t      const avg_instr = instrum.reduce((sum, curr) => sum + curr, 0)/instrum.length ;           //done\n\t      const avg_liveness = liveness.reduce((sum, curr) => sum + curr, 0)/liveness.length ;      //done\n\t      const avg_val = valence.reduce((sum, curr) => sum + curr, 0)/valence.length ;\n\t      const avg_tempo = tempo.reduce((sum, curr) => sum + curr, 0)/tempo.length ;\n\t      const avg_duration = duration.reduce((sum, curr) => sum + curr, 0)/duration.length ;      //done\n\n\t      // Get the most popular genre of the user\n\t      const words = genres.split(',');\n\t      const wordCounts = { };\n\n\t      for(var i = 0; i < words.length; i++)\n\t        wordCounts[words[i]] = (wordCounts[words[i]] || 0) + 1;\n\n\t      const getMax = object => {\n\t        return Object.keys(object).filter(x => {\n\t             return object[x] == Math.max.apply(null, \n\t             Object.values(object));\n\t        });\n\t      };\n\n\t      const userGenre = getMax(wordCounts).toString();\n\t      const song_seed = songIDS.split(','); //get user's top song for recommendation seed\n\n\t      // Get 20 recommendations of content based for the user\n\t      const promise_recom = fetch(\"https://api.spotify.com/v1/recommendations?limit=20&market=ES&seed_artists=\" + artistID + \"&seed_genres=\" + userGenre +\n\t                \"&seed_tracks=\" + song_seed[0] + \"&target_acousticness=\" + avg_acous + \"&target_duration_ms=\" + avg_duration + \n\t                \"&target_energy=\" + avg_energy + \"&target_instrumentalness=\" + avg_instr + \"&target_key=\" + avg_key + \"&target_liveness=\" + avg_liveness +\n\t                \"&target_loudness=\" + avg_loud + \"&target_tempo=\" + avg_tempo + \"&target_valence=\" + avg_val, {\n\t          method: 'GET',\n\t          headers: {'Authorization': 'Bearer ' + accessToken}\n\t      }).then(response => response.json());\n\t      //.then(data => console.log(data));\n\n\t      console.log(promise_recom);\n\n\t    });\n\t    \n\t    //console.log(\"...................\");\n\t    //console.log(this.state.songData);\n\n\t}\n\n  \tcomponentDidMount() {\n    \tconst url = new URL(window.location.href);\n\t\tconst accessToken = url.searchParams.get('access_token');\n\n\t  \tthis.setState({\n        \ttoken: accessToken\n    \t});\n\n    \tif(!accessToken){\n    \t\treturn;\n    \t}\n\n    \t// Fetch User's profile information\n    \tfetch('https://api.spotify.com/v1/me', {\n      \t\tmethod: 'GET',\n      \t\theaders: {'Authorization': 'Bearer ' + accessToken}\n    \t}).then(response => response.json())\n    \t.then(data => this.setState({\n      \t\tuserName: data.display_name\n    \t}));\n\n    \t// Fetch User's most listened/top songs + songs id's\n\t    fetch('https://api.spotify.com/v1/me/top/tracks?limit=' + this.state.limit, {\n\t      \tmethod: 'GET',\n\t      \theaders: {'Authorization': 'Bearer ' + accessToken}\n\t    }).then(response => response.json())\n\t    .then(data => {\n\t    \tlet id = []\n\t    \tlet ids = data.items.map(datas => {\n\t    \t\tif (!id.includes(datas.id)){\n      \t\t\t\tid.push(datas.id)\n\t        \t};\n\t        \treturn id;\n\t    \t})\n\t    \t\n\t    \tthis.setState({\n\t    \t\tsongID: ids\n\t    \t})\n\t    });\n\n\t    // Fetch User's top 3 artists -- nedeed for spotify's api content based recommendations\n\t    fetch('https://api.spotify.com/v1/me/top/artists?limit=3', {\n\t      \tmethod: 'GET',\n\t      \theaders: {'Authorization': 'Bearer ' + accessToken}\n\t    }).then(response => response.json())\n\t    .then(data => {\n\t    \tif(!data.items){\n\t    \t\treturn;\n\t    \t}\n\t    \tlet id = []\n\t    \tlet gen = []\n\t    \tlet ids = data.items.map(datas => {\n\t    \t\tif (!id.includes(datas.id)){\n      \t\t\t\tid.push(datas.id)\n\t        \t};\n\t        \treturn id;\n\t    \t})\n\n\t    \tlet genre = data.items.map(datas => {\n\t    \t\tif(!gen.includes(datas.genres)){\n\t    \t\t\tgen.push(datas.genres)\n\t    \t\t};\n\n\t    \t\tthis.setState({\n\t    \t\t\tgenres: gen.flat()\n\t    \t\t});\n\n\t    \t\treturn gen;\n\t    \t})\n\t    \t\n\t    \tthis.setState({\n\t    \t\tartistID: ids\n\t    \t})\n\n\t    \t\n\t    });\n\n\t    // songIDS,accessToken,genres,artistID\n    \tif(accessToken){\n    \t\tthis.getCB_Recom(this.state.songID.toString(),this.state.token, this.state.genres.toString(), this.state.artistID.toString())\n      \t};\n  \t}\n\n\n  \tshowHandler = ()=>{\n      \tthis.setState({\n        \tisActive: true\n      \t})\n  \t}\n\n  render(){\n    return (\n      <div className=\"App\">\n        <Routes />\n        {this.state.isActive ? \n        \t\n        \t<div>\n        \t<header className=\"App-header\">\n\t        <h1>Music Recommendation System Evaluation</h1>\n\t        <p>\n\t          Music recommendation system where users can choose which recommendation algorithm they enjoy better. \n\t          This app is part of my final project for my degree in data science imparted by University Pompeu Fabra.\n\t        </p>\n\t        </header>\n\t        <br />\n\t        <br />\n\t        <h1 style={{'fontSize': '25px','marginTop': '5px', 'textAlign': 'left', 'border': '3px solid #9DC183', 'padding': '10px'}}>Content Based Recommendations for {this.state.userName} </h1>\n\t        <CBased songID={this.state.songID.toString()} token={this.state.token} artistID={this.state.artistID.toString()} genres={this.state.genres.toString()}/>\n\t        \n\t        <br />\n\t        <br />\n\t        <h1 style={{'fontSize': '25px','marginTop': '5px', 'textAlign': 'left', 'border': '3px solid #9DC183', 'padding': '10px'}}>Collaborative Filtering Recommendations for {this.state.userName} </h1>\n\n\n\t        </div> : <button onClick={() => window.location='http://localhost:8888/login' }>Sign in with Spotify</button>                                                                      \n\n        } \n        <div>{!this.state.isActive && <button onClick={this.showHandler}>Click here to continue</button>}</div>\n        \n\n      </div> \n     \n    );\n  }\n  \n}\n\n//<button onClick={this.showHandler}>Click here to continue</button>\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}